<h1 mat-dialog-title>Comprar {{data.name}}</h1>
<main mat-dialog-content class="px-0 px-sm-auto">
  <mat-stepper
    linear 
    (selectionChange)="onStepChange($event)"
    [orientation]="(stepperOrientation | async)!"
    #stepper
  >
    <!-- Primer Paso -->
    <mat-step
      [stepControl]="firstFormGroup" 
      label="Escoge la Cantidad" errorMessage="Llena la cantidad"
    >
      <ng-template matStepContent>
        <form [formGroup]="firstFormGroup">
          <div class="card border-gray border" > <!-- Cards -->
            <div class="row">
              <div class="col my-auto col-4 col-sm-4 col-md-3 pe-0" > 
                <img
                    class="img-fluid shade rounded my-2 m-0"
                    [src]="data.image.url"
                    alt="{{data.name}} - {{data.category}}"
                    (load)="data.image.loading = false"
                    onerror="this.src='../assets/img/Artboard.svg'"
                  >
                  <mat-progress-bar *ngIf="data.image.loading" mode="indeterminate"></mat-progress-bar>
              </div>
              <div class="col overflow-auto col-6 col-sm-6 col-md-7" >
                <div class="card-body px-0 px-sm-auto py-auto" >
                  <h2 class="card-title fs-4 fw-semibold">{{ data.name }}</h2>
                  <p class="card-text text-body-secondary">
                      Existen: {{data.quantitys}}
                    </p>
                  <div>
                    <span class="me-3">
                      <i class="bi bi-tag tag align-middle"></i>{{data.category}}
                    </span>
                    <span [innerHTML]="data.status | badges"></span>
                  </div>
                </div>
              </div>
              <div class="col m-auto px-0 px-sm-auto col-2 col-sm-2 col-md-2">
                <div class="row gap-4 align-items-center" >
                  <span class="col-12 fs-5 px-0 px-sm-auto text-secondary-emphasis price align-self-start">
                    ${{data.price}} 
                  </span>
                  <div class="col-12 price px-0 px-sm-auto align-self-end">
                    <button
                      matRipple
                      type="button"
                      class="btn btn-light border-gray shade"
                      (click)="disminuir()"
                    >
                      <span class="icon text-black">
                        <i class="bi bi-dash-lg"></i>
                      </span>
                    </button>
                    <button
                      matRipple
                      type="button"
                      class="btn btn-light border-gray shade"
                      (click)="aumentar()"
                    >
                      <span class="icon text-black">
                        <i class="bi bi-plus-lg"></i>
                      </span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="border mt-2 rounded border-gray"><!-- Div Costo Total -->
            <h3 class="border-bottom fs-6 fw-bold border-gray mx-2 px-2 mb-2">Cuenta:</h3>
            <div class="ms-2 p-1">
              <p class="m-0">Precio:          ${{compra.precio}}</p>
              <p class="m-0">Cantidad:  
                <input class="w-fc" matInput placeholder="3" formControlName="cantidad" readonly>
              </p>
              <p >Iva {{compra.iva}}% :  ${{compra.valorIva}}</p>
              <p class="fw-bold fs-6">Total: <span class="fs-5">${{compra.precioTotal}}</span></p>
              <div *ngIf="warning" class="bg-danger rounded">
                <h3 class="fs-5 text-white p-0 text-center">No se puede {{message()}} más la cantidad</h3>
              </div>
            </div>
          </div>
          
          <mat-dialog-actions align="end">
            <button mat-raised-button color="primary" matStepperNext>Next</button>
          </mat-dialog-actions>
        </form>
      </ng-template>
    </mat-step><!-- Fin Primer Paso --> 
    <!-- Segundo Paso -->
    <mat-step 
      [stepControl]="secondFormGroup" 
      label="Escoge el Cliente" errorMessage="Llena el Cliente"
    >
      <ng-template matStepContent>
        <form [formGroup]="secondFormGroup"
        >
          <div class="col px-0 px-sm-auto">
            <mat-form-field appearance="outline"><!-- Buscador Cliente -->
              <mat-label>Buscar Usuario</mat-label>
              <input matInput 
                [formControl]="searchTerm"
                [matAutocomplete]="auto"
                placeholder="Buscar...">
              <mat-autocomplete #auto="matAutocomplete">
                <mat-option 
                  *ngFor="let option of filteredClients | async" 
                  [value]="option.nombreCliente +' '+ option.apellidosCliente"
                  (onSelectionChange)="selecction(option)"
                >
                  {{option.nombreCliente}} {{option.apellidosCliente}}
                </mat-option>
              </mat-autocomplete>
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
          </div><!-- Fin Buscador Cliente -->
          <div class="row mx-3">
            <div class="col-md-6">
              <mat-form-field appearance="outline">
                  <mat-label>Número de Documento</mat-label>
                  <input formControlName="numDoc" matInput placeholder="Número de Documento"> 
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline">
                  <mat-label>Teléfono</mat-label>
                  <input formControlName="telefono" matInput placeholder="Teléfono">
              </mat-form-field>
            </div>

            <div class="col-md-6">
                <mat-form-field appearance="outline">
                    <mat-label>Nombre</mat-label>
                    <input formControlName="nombre" matInput placeholder="Nombre">
                </mat-form-field>
            </div>

            <div class="col-md-6">
                <mat-form-field appearance="outline">
                    <mat-label>Apellido</mat-label>
                    <input formControlName="apellido" matInput placeholder="Apellido">
                </mat-form-field>
            </div>

            <div class="col-md-6">
                <mat-form-field appearance="outline">
                    <mat-label>Dirección</mat-label>
                    <input formControlName="direccion" matInput placeholder="Dirección">
                </mat-form-field>
            </div>

            <div class="col-md-6">
                <mat-form-field appearance="outline">
                    <mat-label>Correo (Opcional)</mat-label>
                    <input formControlName="correo" matInput placeholder="Correo (Opcional)">
                </mat-form-field>
            </div>
          </div>
          <mat-dialog-actions align="end">
            <button mat-stroked-button color="primary" matStepperPrevious>Back</button>
            <button mat-raised-button color="primary" matStepperNext>Next</button>
          </mat-dialog-actions>
        </form>
      </ng-template>
    </mat-step> <!-- Fin Segundo Paso -->
    <!-- Tercer Paso -->
    <mat-step 
      [stepControl]="thirdFormGroup"
      label="Fill out your phone number"
      >
      <ng-template matStepLabel>Done</ng-template>
        <div class="border row p-3 border-gray rounded">
          <div class="col border-end border-gray"><!-- Cliente -->
            <h2>Resumen</h2>
            <form [formGroup]="thirdFormGroup">
              <mat-form-field appearance="outline">
                <mat-label>Nombre Completo</mat-label>
                <input formControlName="nombre" matInput placeholder="Nombre" readonly>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Dirección</mat-label>
                <input formControlName="direccion" matInput placeholder="Dirección" readonly>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Teléfono</mat-label>
                <input formControlName="telefono" matInput placeholder="Teléfono" readonly>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Correo (Opcional)</mat-label>
                <input formControlName="correo" matInput placeholder="Correo (Opcional)" readonly>
             </mat-form-field>
            </form>
          </div>
          <div class="col"><!-- Products -->
            <div class="text-center">
              <img 
                width="130px"
                [src]="CompraData.Producto.image.url"
                [alt]="'Preview compra '+CompraData.Producto.name"
              >
            </div>
            <div class="mt-4">
              <div class="d-flex justify-content-between">
                <p>Producto:</p>
                <p  class="fs-6 fw-bold">{{CompraData.Producto.name}}</p>
              </div>
              <div class="d-flex justify-content-between">
                <p>Cantidad:</p>
                <p class="fs-6 fw-bold">{{CompraData.Cantidad.cantidadTotal}}</p>
              </div>
              <div class="d-flex justify-content-between">
                <p>Precio Unitario:</p>
                <p class="fs-6 fw-bold">${{CompraData.Producto.price}}</p>
              </div>
              <div class="d-flex justify-content-between">
                <p class="fs-6 fw-bold">Total:</p>  
                <p class="fs-5 fw-bold">${{CompraData.Cantidad.precioTotal}}</p>
              </div>
            </div>
          </div>

        </div>
        <mat-dialog-actions class="row">
          <div class="col justify-content-start">
            <button mat-stroked-button color="primary" matStepperPrevious>Back</button>
            <button mat-raised-button color="primary" (click)="stepper.reset()" (click)="reset()">Reset</button>
          </div>
          <div class="col d-flex justify-content-end">
            <button mat-stroked-button color="warn" (click)="onNoClick()">No, Cancelar</button>
            <button mat-button 
              class="btn-success" 
              [disabled]="!firstFormGroup.valid || !secondFormGroup.valid || !thirdFormGroup.valid"
              [mat-dialog-close]="data"
              (click)="comprar()"
              [matTooltip]="labelToolTip"
              matTooltipPosition="above"
            >Comprar</button>
          </div>
        </mat-dialog-actions>
        
    </mat-step> <!-- Fin Tercer Paso -->

  </mat-stepper>
  
</main>

